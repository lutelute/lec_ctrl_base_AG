# 第8章：フィードバック制御とフィードフォワード制御 (詳細版)

本章では、制御構造の違いによる特性の変化を定量的に解析します。
フィードバック (FB) 制御の強力なロバスト性と、フィードフォワード (FF) 制御の即応性・完全追従性を数式で示し、実用的な「2自由度制御系」の設計論へつなげます。

---

## 8.1 制御系の構造と伝達関数

### 8.1.1 フィードバック (FB) 制御系
出力 $y$ を測定し、目標値 $r$ との偏差 $e = r - y$ に基づいて操作量 $u$ を決定する方式です。
外乱 $d$ が印加される場合を考えます。

**ブロック線図**:
$$ r \xrightarrow{+} \bigcirc \xrightarrow{e} \boxed{C(s)} \xrightarrow{u} \bigcirc \xrightarrow{+} \boxed{P(s)} \xrightarrow{y} $$
$$ \quad \quad \uparrow - \quad \quad \quad \quad \quad \quad \uparrow + $$
$$ \quad \quad | \xleftarrow{\quad \quad \quad \quad \quad \quad} | $$
$$ \quad \quad \quad \quad \quad \quad \quad d $$

- $P(s)$: 制御対象 (Plant)
- $C(s)$: 制御器 (Controller)

**関係式**:
$$y = P(u + d) = P(C(r - y) + d)$$
$$y = PCr - PCy + Pd$$
$$(1 + PC)y = PCr + Pd$$

よって出力 $y$ は：
> $$ y = \frac{PC}{1+PC} r + \frac{P}{1+PC} d $$

この $\frac{P}{1+PC}$ を **感度関数 (Sensitivity Function)** $S(s)$ と呼ぶことがあります（正確には $\frac{1}{1+PC}$ が感度関数）。
ループゲイン $L(s) = P(s)C(s)$ が大きい帯域 ($|L| \gg 1$) では：
- $r$ からの伝達関数 $\approx 1$ （追従性良）
- $d$ からの伝達関数 $\approx 1/C$ （外乱抑制良）

### 8.1.2 フィードフォワード (FF) 制御系
外乱 $d$ を直接測定できる場合、または目標値 $r$ が事前に分かっている場合に用います。

**外乱FF**:
外乱 $d$ をセンサで測定し、補償器 $C_f(s)$ を通して操作量に加えます。
$$ u = C_{fb}(r-y) - C_f d $$
$$ y = P(u+d) = P(C_{fb}(r-y) - C_f d + d) $$
$$ y = P C_{fb} (r-y) + P(1 - C_f) d $$
整理すると、
> $$ y = \frac{P C_{fb}}{1 + P C_{fb}} r + \frac{P(1 - C_f)}{1 + P C_{fb}} d $$

ここで、**$C_f = 1$** と選べば、外乱項は完全にゼロになります（**外乱相殺**）。
もし $P$ が $u$ の入力位置と $d$ の入力位置で異なる伝達関数を持つ場合（$y = P_u u + P_d d$）、
$u = - C_f d$ として $P_u (-C_f d) + P_d d = 0$ となるように、
$$ C_f(s) = \frac{P_d(s)}{P_u(s)} $$
と設計します。

---

## 8.2 2自由度制御系 (Two-Degree-of-Freedom Control)

「目標値追従特性」と「外乱抑制特性」を独立に設計できる制御系です。

### 8.2.1 構造
- フィードバック制御器 $C(s)$: 外乱抑制とロバスト安定性を担当。
- フィードフォワード制御器 $F(s)$: 目標値追従特性を担当。

$$ u = C(r - y) + F r = (C+F)r - Cy $$
あるいは、より一般的な構成として：
$$ u = C_1(s) r - C_2(s) y $$

### 8.2.2 設計手順（FF先行型）
1.  まず、外乱 $d$ やモデル化誤差 $\Delta P$ に対して十分な減衰を与えるように $C(s)$ を設計します（高ゲインFB）。
2.  この定常偏差や応答遅れを補償するように $F(s)$ を設計します。
    理想的には、全体の伝達関数 $W(s)$ を $1$ にしたい場合、
    $$ \frac{P(C+F)}{1+PC} = 1 \implies P(C+F) = 1+PC \implies PF = 1 \implies F = \frac{1}{P} $$
    つまり、**逆システム** をFF項として加えることになります。
    （実際にはプロパー性や因果律の問題で完全な逆システムは実現できないため、近似を用います）

---

## 8.3 演習問題：定常偏差の比較

**問題**:
制御対象 $P(s) = \frac{1}{s+1}$ に対し、目標値 $r(t)=t$（ランプ入力）を加える。
(1) オープンループ制御 $u = \frac{1}{P(0)} r = r$ の場合の定常偏差 $e_{ss}$。
(2) P制御 $u = K(r-y)$ の場合の定常偏差 $e_{ss}$。

**解答**:
(1) **オープンループ**:
    $Y(s) = P(s)U(s) = \frac{1}{s+1} \frac{1}{s^2}$
    誤差 $E(s) = R(s) - Y(s) = \frac{1}{s^2} - \frac{1}{s^2(s+1)} = \frac{s+1-1}{s^2(s+1)} = \frac{1}{s(s+1)}$
    最終値定理: $\lim_{t\to\infty} e(t) = \lim_{s\to 0} s E(s) = \lim_{s\to 0} \frac{1}{s+1} = 1$
    定常偏差は **1**。

(2) **FB制御 (P制御)**:
    閉ループ伝達関数 $W(s) = \frac{K P}{1+KP} = \frac{K/(s+1)}{1 + K/(s+1)} = \frac{K}{s + 1+K}$
    誤差伝達関数 $W_e(s) = \frac{E}{R} = \frac{1}{1+KP} = \frac{1}{1 + \frac{K}{s+1}} = \frac{s+1}{s + 1+K}$
    $E(s) = \frac{s+1}{s + 1+K} \frac{1}{s^2}$
    最終値定理: $\lim_{s\to 0} s E(s) = \lim_{s\to 0} \frac{s+1}{s(s+1+K)}$
    これは $s\to 0$ で分母が0になるため、**無限大** に発散します。
    （1型のランプ入力に追従するには、積分器を含む2型システムにする必要があります。P制御だけではランプ入力には追従できません。ステップ入力ならば偏差は $1/(1+K)$ に圧縮されます）

**考察**:
オープンループではモデルが完璧なら偏差ゼロにできるはずですが（今回は $u=r$ なのでDCゲイン=1の逆系になっている）、ランプ入力という動的な信号に対しては $P(s)$ の遅れ（時定数）の影響で偏差が生じます。
つまり、動的な補償（FF制御 $u = (T s + 1) r$ など）が必要です。
